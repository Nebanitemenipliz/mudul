from telethon import events
from telethon import errors
from googletrans import Translator
from .. import loader, utils

class TranslateMod(loader.Module):
    """Переводит текст"""
    def __init__(self):
        self.name = "Translate"
        self.config = loader.ModuleConfig("DEFAULT_TRANSLATE_TO", "ru", "Переводить по умолчанию на")
        self.translator = Translator()

    @loader.tds
    async def translatecmd(self, message):
        """Переводит текст"""
        if not message.is_reply:
            await message.edit("Нет текста для перевода.")
            return

        # получаем текст из сообщения
        reply_msg = await message.get_reply_message()
        text = reply_msg.text

        # получаем язык и направление перевода
        translate_to = self.config["DEFAULT_TRANSLATE_TO"].lower()
        lang_to = "uk" if translate_to == "ua" else translate_to
        lang_from = self.translator.detect(text).lang

        # переводим текст
        try:
            translated = self.translator.translate(text, dest=lang_to, src=lang_from).text
        except errors.TranslateError as e:
            await message.edit(f"Ошибка при переводе текста: {e}")
            return

        # отображаем переведенный текст
        await message.edit(f"{translated}\n\nПереведено с {lang_from.upper()} на {translate_to.upper()}")

    async def client_ready(self, client, db):
        self.client = client
