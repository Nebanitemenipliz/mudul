import datetime
from telethon import events
from telethon.tl import types
from telethon.tl.functions.users import GetFullUserRequest
from telethon.tl.types import User

from .. import loader, utils


@loader.tds
class CountdownMod(loader.Module):
    """Показывает сколько дней осталось до целевой даты"""
    strings = {"name": "Countdown"}

    def __init__(self):
        self.config = loader.ModuleConfig("target_date", datetime.datetime.strptime("2023-03-18", "%Y-%m-%d").date(), "Целевая дата для отсчета")

    async def countdowncmd(self, message: types.Message):
        """Показывает сколько дней осталось до целевой даты"""
        today = datetime.date.today()
        target_date = self.config["target_date"]
        days_left = (target_date - today).days
      
        if days_left > 0:
            message_text = f"До {target_date.strftime('%d.%m.%Y')} осталось {days_left} дней"
        elif days_left == 0:
            message_text = f"Сегодня {target_date.strftime('%d.%m.%Y')}!"
        else:
            message_text = f"{target_date.strftime('%d.%m.%Y')} уже прошло"

        await utils.answer(message, message_text)

    async def client_ready(self, client, db):
        self.client = client
